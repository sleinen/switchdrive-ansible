---

#####################
# networks
os_network: "drive"

#####################
# networks
os_security_group:
  - name: "ssh"
    description: "ssh access"
    rules:
      - { protocol: "tcp", port_range_min: "22", port_range_max: "22", remote_ip_prefix: "0.0.0.0/0", state: "present" }

#####################
# server groups
os_server_group:
  list:
    - { name: "load_balancers", policies: ['anti-affinity'] }
    - { name: "redis",          policies: ['anti-affinity'] }
    - { name: "graphite",       policies: ['anti-affinity'] }
    - { name: "elk",            policies: ['anti-affinity'] }
    - { name: "web",           policies: ['anti-affinity'] }
    - { name: "sync",           policies: ['anti-affinity'] }
    - { name: "mariadb",        policies: ['anti-affinity'] }
    - { name: "ldap",           policies: ['anti-affinity'] }
  # look up id after they were created: `openstack server group list`
  load_balancers: "49b089f0-7987-4d7e-843c-0818efbaaa38"
  redis:          "812b5d3c-bce7-423c-9ce9-aea3fd356376"
  graphite:       "73f2925e-d328-40e2-97d7-4bef59eaba1e"
  elk:            "2c767e1e-c144-40d5-9cbe-db9b3534b9b9"
  web:            "0ea252f8-466b-48ce-8c92-b73a778acbc0"
  sync:           "fa00d49f-ddeb-413d-98a4-7d17dbd2ac20"
  mariadb:        "fb35cfd6-59e0-42df-a86e-79817723fea9"
  ldap:           "1104f334-85a1-4aaf-ae6a-95d37fc84ace"

#####################
# servers
os_server:
  jumphost1:  { ip: "{{ jumphost_internal }}",                                   flavor: "c1.small",     image: "{{os_image['xenial']}}", root_size: "20", security_groups: "default,ssh",                  hints: {} }

  lb1:        { ip: "{{ hostvars[groups['lb'][0]].inventory_hostname }}",        flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "20", security_groups: "default,development,ldap,web", hints: { group: "{{ os_server_group['load_balancers'] }}" } }
  lb2:        { ip: "{{ hostvars[groups['lb'][1]].inventory_hostname }}",        flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "20", security_groups: "default,development,ldap,web", hints: { group: "{{ os_server_group['load_balancers'] }}" } }

  redis1:     { ip: "{{ hostvars[groups['redis'][0]].inventory_hostname }}",     flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['redis'] }}" } }
  redis2:     { ip: "{{ hostvars[groups['redis'][1]].inventory_hostname }}",     flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['redis'] }}" } }

  mgmt1:      { ip: "{{ hostvars[groups['mgmt'][0]].inventory_hostname }}",      flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "60", security_groups: "default",                      hints: {} }
  dev1:       { ip: "{{ hostvars[groups['dev'][0]].inventory_hostname }}",       flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "60", security_groups: "default",                      hints: {} }

  web1:       { ip: "{{ hostvars[groups['web'][0]].inventory_hostname }}",       flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['web'] }}" } }
  web2:       { ip: "{{ hostvars[groups['web'][1]].inventory_hostname }}",       flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['web'] }}" } }
  web3:       { ip: "{{ hostvars[groups['web'][2]].inventory_hostname }}",       flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['web'] }}" } }
  web4:       { ip: "{{ hostvars[groups['web'][3]].inventory_hostname }}",       flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['web'] }}" } }
  web10:      { ip: "{{ hostvars[groups['web'][9]].inventory_hostname }}",       flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['web'] }}" } }
  web11:      { ip: "{{ hostvars[groups['web'][10]].inventory_hostname }}",      flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['web'] }}" } }
  web12:      { ip: "{{ hostvars[groups['web'][11]].inventory_hostname }}",      flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['web'] }}" } }
  web13:      { ip: "{{ hostvars[groups['web'][12]].inventory_hostname }}",      flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['web'] }}" } }
  web14:      { ip: "{{ hostvars[groups['web'][13]].inventory_hostname }}",      flavor: "drive-40-4-4", image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['web'] }}" } }

  sync1:      { ip: "{{ hostvars[groups['sync'][0]].inventory_hostname }}",      flavor: "c1.xxlarge",   image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['sync'] }}" } }
  sync2:      { ip: "{{ hostvars[groups['sync'][1]].inventory_hostname }}",      flavor: "c1.xxlarge",   image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['sync'] }}" } }
  sync3:      { ip: "{{ hostvars[groups['sync'][2]].inventory_hostname }}",      flavor: "c1.xxlarge",   image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['sync'] }}" } }
  sync4:      { ip: "{{ hostvars[groups['sync'][3]].inventory_hostname }}",      flavor: "c1.xxlarge",   image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['sync'] }}" } }
  sync11:     { ip: "{{ hostvars[groups['sync'][10]].inventory_hostname }}",     flavor: "c1.xxlarge",   image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['sync'] }}" } }
  sync12:     { ip: "{{ hostvars[groups['sync'][11]].inventory_hostname }}",     flavor: "c1.xxlarge",   image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['sync'] }}" } }
  sync13:     { ip: "{{ hostvars[groups['sync'][12]].inventory_hostname }}",     flavor: "c1.xxlarge",   image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['sync'] }}" } }
  sync14:     { ip: "{{ hostvars[groups['sync'][13]].inventory_hostname }}",     flavor: "c1.xxlarge",   image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",                      hints: { group: "{{ os_server_group['sync'] }}" } }

  graphite1:  { ip: "{{ hostvars[groups['graphite'][0]].inventory_hostname }}",  flavor: "drive-40-4-4-120-ssd",     image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",          hints: { group: "{{ os_server_group['graphite'] }}" } }
  graphite2:  { ip: "{{ hostvars[groups['graphite'][1]].inventory_hostname }}",  flavor: "drive-40-4-4-120-ssd",     image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default",          hints: { group: "{{ os_server_group['graphite'] }}" } }

  elk1:       { ip: "{{ hostvars[groups['elk'][0]].inventory_hostname }}",       flavor: "drive-20-64-16",           image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default,elk",      hints: { group: "{{ os_server_group['elk'] }}" } }
  elk2:       { ip: "{{ hostvars[groups['elk'][1]].inventory_hostname }}",       flavor: "drive-20-64-16",           image: "{{os_image['xenial']}}", root_size: "40", security_groups: "default,elk",      hints: { group: "{{ os_server_group['elk'] }}" } }

  db6:        { ip: "{{ hostvars[groups['mariadb'][5]].inventory_hostname }}",   flavor: "drive-100-245-46-1.2-ssd", image: "{{os_image['xenial']}}", root_size: "80", security_groups: "default",          hints: { group: "{{ os_server_group['mariadb'] }}" } }

# ceph data volumes; do not add root volumes and ssd-ephemeral volumes like e.g. the one for graphite.
os_volumes:
  elk1:
    - { name: "000", state: "mounted", device: "/dev/vdb", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "001", state: "mounted", device: "/dev/vdc", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "002", state: "mounted", device: "/dev/vdd", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "003", state: "mounted", device: "/dev/vde", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "004", state: "mounted", device: "/dev/vdf", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "005", state: "mounted", device: "/dev/vdg", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "006", state: "mounted", device: "/dev/vdh", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "007", state: "mounted", device: "/dev/vdi", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "008", state: "mounted", device: "/dev/vdj", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "009", state: "mounted", device: "/dev/vdk", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
  elk2:
    - { name: "000", state: "mounted", device: "/dev/vdb", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "001", state: "mounted", device: "/dev/vdc", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "002", state: "mounted", device: "/dev/vdd", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "003", state: "mounted", device: "/dev/vde", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "004", state: "mounted", device: "/dev/vdf", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "005", state: "mounted", device: "/dev/vdg", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "006", state: "mounted", device: "/dev/vdh", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "007", state: "mounted", device: "/dev/vdi", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "008", state: "mounted", device: "/dev/vdj", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }
    - { name: "009", state: "mounted", device: "/dev/vdk", size: "100", fs: "xfs", owner: "{{elasticsearch_uid}}", group: "{{elasticsearch_gid}}", mode: "0755" }


#####################
# vips

# use `openstack port list` to find ports
# verify settings with: `openstack port show <port>`

os_vip:
  ips:
    - { name: "lb_vip1", ip: "{{ hostvars[groups['lb_vip'][0]].inventory_hostname }}" }
    - { name: "lb_vip2", ip: "{{ hostvars[groups['lb_vip'][1]].inventory_hostname }}" }
    - { name: "carbon_vip", ip: "{{ hostvars[groups['carbon_vip'][0]].inventory_hostname }}" }
  ports:
    # lb
    - { name: '{{ site }}-lb1-port_{{ os_network }}', ips: [ { ip_address: "{{ hostvars[groups['lb_vip'][0]].inventory_hostname }}" }, { ip_address: "{{ hostvars[groups['lb_vip'][1]].inventory_hostname }}" } ] }
    - { name: '{{ site }}-lb2-port_{{ os_network }}', ips: [ { ip_address: "{{ hostvars[groups['lb_vip'][0]].inventory_hostname }}" }, { ip_address: "{{ hostvars[groups['lb_vip'][1]].inventory_hostname }}" } ] }
    # carbon
    - { name: '{{ site }}-graphite1-port_{{ os_network }}', ips: [ { ip_address: "{{ hostvars[groups['carbon_vip'][0]].inventory_hostname }}" } ] }
    - { name: '{{ site }}-graphite2-port_{{ os_network }}', ips: [ { ip_address: "{{ hostvars[groups['carbon_vip'][0]].inventory_hostname }}" } ] }
