[maxscale]
threads=8

[Splitter Service]
type=service
router=readwritesplit
localhost_match_wildcard_host=1
servers={% for host in groups["mariadb"] %}{{ host}},{% endfor %}

max_slave_connections=100%
#max_slave_connections=2

user={{ maxscale_user }}
passwd={{ maxscale_password }}
router_options=slave_selection_criteria=LEAST_CURRENT_OPERATIONS

[Splitter Listener]
type=listener
service=Splitter Service
protocol=MySQLClient
port={{ maxscale_port }}
socket={{ maxscale_socket }} 

{% for host in groups["mariadb"] %}
[{{ host }}]
type=server
address={{ hostvars[host].inventory_hostname }}
port=3306
protocol=MySQLBackend
priority={{loop.index}}

{% endfor %}

[Galera Monitor]
type=monitor
module=galeramon
monitor_interval=1000
#disable_master_failback=1
use_priority=true
servers={% for host in groups["mariadb"] %}{{ host}},{% endfor %}

user={{ maxscale_user }}
passwd={{ maxscale_password }}

[CLI]
type=service
router=cli

[CLI Listener]
type=listener
service=CLI
protocol=maxscaled
address=localhost
port=6603


[RR]
type=service
router=readconnroute
router_options=synced
servers={% for host in groups["mariadb"] %}{{ host}},{% endfor %}

user={{ maxscale_user }}
passwd={{ maxscale_password }}

